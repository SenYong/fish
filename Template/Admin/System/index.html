<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>系统设置 - 小鱼博客管理系统</title>
<link rel="stylesheet" type="text/css" href="__CSS__/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="__CSS__/style.css">
<link rel="stylesheet" type="text/css" href="__CSS__/font-awesome.min.css">
<link rel="apple-touch-icon-precomposed" href="__IMG__/icon/icon.png">
<link rel="shortcut icon" href="__IMG__/icon/favicon.ico">
<script src="__JS__/jquery-2.1.4.min.js"></script>
</head>
<body class="user-select">
<section class="container-fluid">
  <include file="Public:header" />
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="main">
      <div class="row">
        <div class="col-md-12">
          <empty name="info['id']">
             <h1 class="page-header">系统设置</h1>
          <else/>
             <h1 class="page-header">修改设置</h1>
             <input type="hidden" id="id" value="{$info.id}">
          </empty>
          <div>
            <div class="form-group">
              <label for="category-name">网站标题</label>
              <input type="text" id="title" class="form-control" placeholder="在此处输入网站标题" value="{$info.title}">
              <span class="prompt-text">这将是它在站点上显示的名字。</span> 
            </div>
            <div class="form-group">
              <label for="category-alias">网站二级标题</label>
              <input type="text" id="title2" class="form-control" placeholder="在此处输入网站二级标题" value="{$info.title2}">
              <span class="prompt-text">这将是它在站点上显示的名字。</span> 
            </div>
            <div class="form-group">
              <label for="category-keywords">关键字</label>
              <input type="text" id="keyword" class="form-control" placeholder="在此处输入网站关键字" value="{$info.keyword}">
              <span class="prompt-text">关键字会出现在网页的keywords属性中。</span> 
            </div>
            <div class="form-group">
              <label for="category-keywords">注册时间</label>
              <input type="text" id="createtime" class="form-control" placeholder="在此处输入网站注册时间" value="{$info.createtime|date='Y-m-d H:i:s',###}">
            </div>
            <div class="form-group">
              <label for="category-describe">描述</label>
              <textarea class="form-control" id="desc" rows="4">{$info.desc}</textarea>
              <span class="prompt-text">描述会出现在网页的description属性中。</span> 
            </div>
            <div class="form-group">
              <label for="category-name">站长</labl>
              <input type="text" id="username" class="form-control" placeholder="在此处输入站长名称" value="{$info.username}">
            </div>
            <div class="form-group">
              <label for="category-name">网名</label>
              <input type="text" id="netname" class="form-control" placeholder="在此处输入网名" value="{$info.netname}">
            </div>
            <div class="form-group">
              <label for="category-name">QQ</label>
              <input type="text" id="qq" class="form-control" placeholder="在此处输入QQ号码" value="{$info.qq}">
            </div>
            <div class="form-group">
              <label for="category-name">职业</label>
              <input type="text" id="profession" class="form-control" placeholder="在此处输入职业" value="{$info.profession}">
            </div>
            <div class="form-group">
              <label for="category-name">爱好</label>
              <input type="text" id="hobby" class="form-control" placeholder="在此处输入爱好" value="{$info.hobby}">
            </div>
            <div class="form-group">
              <label for="category-name">爱说</label>
              <input type="text" id="motto" class="form-control" placeholder="在此处输入人生格言" value="{$info.motto}">
            </div>
            <div class="form-group">
              <label for="category-name">爱说描述</label>
              <input type="text" id="saying" class="form-control" placeholder="在此处输入爱好" value="{$info.saying}">
            </div>
            <div class="add-article-box">
              <h2 class="add-article-box-title"><span>标题图片</span></h2>
              <div class="add-article-box-content">
                <input type="text" class="form-control" placeholder="点击按钮选择图片" id="pictureUpload" name="titlepic" value="{$info.img}" disabled>
              </div>
              <div class="add-article-box-footer">
                <button class="btn btn-default" type="button" ID="upImage">选择</button>
              </div>
            </div>
            <div class="form-group">
              <label for="category-describe">个人说明</label>
              <textarea class="form-control" id="explain" rows="4">{$info.explain}</textarea>
            </div>
            <div class="form-group">
              <label for="category-describe">关于程序</label>
              <textarea class="form-control" id="program" rows="4">{$info.program}</textarea>
            </div>
            <div class="form-group">
              <label for="category-name">网站域名</label>
              <input type="text" id="service" class="form-control" placeholder="在此处输入网站域名" value="{$info.service}">
            </div>
            <div class="form-group">
              <label for="category-name">声明</label>
              <input type="text" id="statement" class="form-control" placeholder="在此处输入网站声明" value="{$info.statement}">
            </div>
            <div class="form-group">
              <label for="category-name">访问量</label>
              <input type="text" id="hit" class="form-control" placeholder="访问总量" value="{$info.hit}">
            </div>
            <empty name="info['id']">
               <button class="btn btn-primary" type="submit" name="submit" id="addSystem">提交</button>
            <else/>
               <button class="btn btn-primary" type="submit" name="submit" id="editSystem">修改</button>
            </empty>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<include file="Public:info"/>
<script src="__JS__/bootstrap.min.js"></script> 
<script src="__JS__/admin-scripts.js"></script>
<script src="__LIB__/ueditor.config.js"></script> 
<script src="__LIB__/ueditor.all.min.js"> </script> 
<script src="__LIB__/lang/zh-cn/zh-cn.js"></script>  
<script id="uploadEditor" type="text/plain" style="display:none;"></script>
<script src="__JS__/jquery.gritter.min.js"></script>
<script src="__JS__/my.js"></script>
<script>
//是否确认删除
$(function(){   
  	$("#main table tbody tr td a").click(function(){
  		var name = $(this);
  		var id = name.attr("rel"); //对应id  
  		if (event.srcElement.outerText === "删除") 
  		{
  			if(window.confirm("此操作不可逆，是否确认？"))
  			{
  				$.ajax({
  					type: "POST",
  					url: "/Category/delete",
  					data: "id=" + id,
  					cache: false, //不缓存此页面   
  					success: function (data) {
  						window.location.reload();
  					}
  				});
  			};
  		};
  	}); 
    //重新实例化一个编辑器，防止在上面的editor编辑器中显示上传的图片或者文件
    _uploadEditor = UE.getEditor('uploadEditor');
    _uploadEditor.ready(function () {
        //设置编辑器不可用
        //_uploadEditor.setDisabled();
        //隐藏编辑器，因为不会用到这个编辑器实例，所以要隐藏
        _uploadEditor.hide();
        //侦听图片上传
        _uploadEditor.addListener('beforeInsertImage', function (t, arg) {
            //将地址赋值给相应的input,只去第一张图片的路径
            $("#pictureUpload").attr("value", arg[0].src);
            //图片预览
            //$("#imgPreview").attr("src", arg[0].src);
        })
        //侦听文件上传，取上传文件列表中第一个上传的文件的路径
        _uploadEditor.addListener('afterUpfile', function (t, arg) {
            $("#fileUpload").attr("value", _uploadEditor.options.filePath + arg[0].url);
        })
    });
    //弹出图片上传的对话框
    $('#upImage').click(function () {
        var myImage = _uploadEditor.getDialog("insertimage");
        myImage.open();
    });
    //弹出文件上传的对话框
    function upFiles() {
        var myFiles = _uploadEditor.getDialog("attachment");
        myFiles.open();
    }
    $('#addSystem').click(function(){
       var title = $('#title').val();
       var title2 = $('#title2').val();
       var keyword = $('#keyword').val();
       var createtime = $('#createtime').val();
       var desc = $("#desc").val();
       var username = $('#username').val();
       var netname = $('#netname').val();
       var qq = $('#qq').val();
       var profession = $('#profession').val();
       var hobby = $('#hobby').val();
       var motto = $('#motto').val();
       var img = $('#pictureUpload').val();
       var explain = $('#explain').val();
       var program = $('#program').val();
       var service = $('#service').val();
       var statement = $('#statement').val();
       var hit = $('#hit').val();
       var saying = $('#saying').val();
       if(createtime == ''){
         error('请填写注册时间');
         return false;
       }
       $('#addSystem').attr('disabled',true);
       $.ajax({
         url: '/Admin/System/add',
         type: 'post',
         async: true,
         data: {'title':title, 'title2':title2, 'keyword':keyword, 'createtime':createtime, 'desc':desc, 'username':username, 'qq':qq, 'profession':profession, 'hobby':hobby, 'motto':motto, 'netname':netname, 'img':img, 'explain':explain, 'program':program, 'service':service, 'statement':statement, 'hit':hit, 'saying':saying},
         success: function(data){
           if(data.error == 0){
             success('',data.msg,'__SELF__');
           }else{
             error(data.msg);
             $('#addSystem').removeAttr('disabled');
           }
         },
         error: function(data){
           error(data.msg);
           $('#addSystem').removeAttr('disabled');
         }
       })
    })
    $('#editSystem').click(function(){
       var id = $('#id').val();
       var title = $('#title').val();
       var title2 = $('#title2').val();
       var keyword = $('#keyword').val();
       var createtime = $('#createtime').val();
       var desc = $("#desc").val();
       var username = $('#username').val();
       var netname = $('#netname').val();
       var qq = $('#qq').val();
       var profession = $('#profession').val();
       var hobby = $('#hobby').val();
       var motto = $('#motto').val();
       var img = $('#pictureUpload').val();
       var explain = $('#explain').val();
       var program = $('#program').val();
       var service = $('#service').val();
       var statement = $('#statement').val();
       var hit = $('#hit').val();
       var saying = $('#saying').val();
       $('#editSystem').attr('disabled',true);
       $.ajax({
         url: '/Admin/System/edit',
         type: 'post',
         async: true,
         data: {'id':id ,'title':title, 'title2':title2, 'keyword':keyword, 'createtime':createtime, 'desc':desc, 'username':username, 'netname':netname, 'qq':qq, 'profession':profession, 'hobby':hobby, 'motto':motto, 'img':img, 'explain':explain, 'program':program, 'service':service, 'statement':statement, 'hit':hit, 'saying':saying},
         success: function(data){
            if(data.error == 0){
              success('',data.msg,'__SELF__');
            }else{
              error(data.msg);
              $('#editSystem').removeAttr('disabled');
            }
         },
         error: function(data){
           error(data.msg);
           $('#editSystem').removeAttr('disabled');
         }
       })
    })  
});
</script>
</body>
</html>
